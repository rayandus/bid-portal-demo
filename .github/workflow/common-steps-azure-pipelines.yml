steps:
- script: |
  echo "Build.Reason: $(Build.Reason)"
  echo "isPullRequest: $(isPullRequest)"
  echo "isDev: $(isDev)"

# Use Node version 18.x
- task: NodeTool@0
  inputs:
    versionSpec: $(nodeVersion)
  displayName: 'Use Node.js $(nodeVersion)'

# Use pnpm (much faster)
- script: |
    npm install -g pnpm
  displayName: 'Install pnpm'

# Install the packages
- script: |
    pnpm install
  displayName: 'Install project packages'

# Pre-build checks: lint, test
- script: |
    pnpm lint
  displayName: 'Pre-build checks: lint, test'

# Build the project
- script: |
    pnpm build
  displayName: 'Build project'

# Publish the build artifact
- task: PublishBuildArtifacts@1
  inputs:
    # dist folder only. We don't need the rest of the files
    pathtoPublish: 'dist'
    artifactName: $(artifactName)
    publishLocation: 'Container'
  # Exclude PRs from creating an artifact
  condition: and(succeeded(), ne(variables['isPullRequest'], true), eq(variables['isDev'], true))
